from ultralytics import YOLO
import cv2
import sys
import json

# Load pre-trained YOLOv8 model
model = YOLO("yolov8n.pt")  # Nano model for speed; use yolov8s.pt for better accuracy if needed

def detect_objects(image_path):
    img = cv2.imread(image_path)
    results = model(img)
    detected_objects = []
    for result in results:
        for box in result.boxes:
            class_id = int(box.cls[0])
            label = model.names[class_id]
            confidence = float(box.conf[0])
            detected_objects.append({"label": label, "confidence": confidence})
    return detected_objects

if __name__ == "__main__":
    image_path = sys.argv[1]  # Get image path from command line
    objects = detect_objects(image_path)
    print(json.dumps(objects))  # Output as JSON for Java to read